#!/bin/bash

set -e

echo "ğŸš€ Starting Minikube with Kubeflow configuration..."

# ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ
minikube delete 2>/dev/null || true

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Minikube ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¼Ğ¸ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸
minikube start \
  --cpus=6 \
  --memory=12g \
  --disk-size=50g \
  --kubernetes-version=v1.28.0 \
  --driver=docker \
  --addons=ingress,metrics-server,storage-provisioner

echo "âœ… Minikube started successfully"

# Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ°Ğ´Ğ´Ğ¾Ğ½Ñ‹
minikube addons enable ingress
minikube addons enable metrics-server

echo "ğŸ“¦ Installing Argo Workflows (required for Kubeflow Pipelines)..."
kubectl create namespace argo 2>/dev/null || true
kubectl apply -n argo -f https://github.com/argoproj/argo-workflows/releases/download/v3.5.5/install.yaml

echo "â³ Waiting for Argo Workflows..."
kubectl wait --for=condition=Ready pods --all -n argo --timeout=300s

echo "ğŸ‰ Minikube setup complete!"
echo ""
echo "Cluster Info:"
minikube status
kubectl version --short
kubectl get nodes